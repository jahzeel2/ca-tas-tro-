@model GeoSit.Client.Web.Models.DGCeITModel
@{
    ViewBag.Title = "Interfase DGCeIT";
    ViewBag.Description = "";
    ViewBag.comparacion = "Manzana";
}




<link href="~/Content/jquery.jscrollpane.css" rel="stylesheet" />

<link href="~/Content/dataTables.bootstrap.css" rel="stylesheet" />
<link href="~/Content/Interfaces.css" rel="stylesheet" />

<link href="~/Content/formValidation.min.css" rel="stylesheet" />

<link href="~/Content/select2-bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap-datetimepicker.css" rel="stylesheet" />




<div class="modal fade" id="myModal" tabindex="-100" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false" data-keyboard="false">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="height: 60px">
                <h4 class="modal-title col-lg-11 col-xs-11 col-sm-11 col-md-11" id="myModalLabel">@ViewBag.Title</h4>
                <span aria-hidden="true" id="btnCancelar" class="fa fa-close fa-2x white cursor-pointer" style="padding-top:3px;" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
                @*<img id="btnCancelar" title="Cerrar" class="pull-right" src="~/Content/images/Seguridad/icons/light/32/cerrar.png" style="cursor:pointer; align-content:flex-end; ">*@
            </div>

            <div class="modal-body modal-body-scroll">


                @*<div class="row" style="height:20em;"></div>*@


                <div class="row" style="height:1em;"></div>

                <div id="accordionParcelas">
                    <div class="panel-group panel-primary">
                        <div class="panel-heading panel-activo" id="PanelParcela" style="height: 40px; padding-top: 10px;">
                            <div class="col-lg-11 col-xs-11 col-sm-11 col-md-11">
                                PARCELA
                            </div>
                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 text-right ">
                                <span id="Flecha_parcelas" class="glyphicon glyphicon-chevron-down flecha-activada" style="cursor:pointer; display:inline;"></span>

                            </div>
                        </div>
                        <div id="accordion_panel_1" class="panel-collapse collapse" aria-expanded="true" style="border: solid; border-width: 1px; border-color: #a5a5a5; color: #000000">
                            <div class="panel-body" style="padding: 5px 0 5px 0; ">
                                <div class="form-group">

                                    @using (Ajax.BeginForm("InterfaseDGCeIT", "Interfaces", new { }, new AjaxOptions { }, new { id = "formParcela", role = "form", novalidate = "" }))
                                    { @Html.AntiForgeryToken()

                                        <div class="row" style="height:1em;"></div>

                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div id="contedor-Circ" class="col-lg-2 col-xs-2 col-sm-2 col-md-2">
                                                Circ.
                                                <input class="centrado form-control" id="Circ" style="width:100%;" type="text" name="model.EntradaParcela.circ" value="@Model.EntradaParcela.circ">
                                                @*@Html.TextBoxFor(model => model.EntradaParcela.circ, new { @id = "Circ", @class = "centrado form-control", @style = "width:100%;" })*@
                                            </div>
                                            <div class="col-lg-2 col-xs-2 col-sm-2 col-md-2">
                                                Sec.
                                                <input class="centrado form-control" id="Sec" style="width:100%;" type="text" name="model.EntradaParcela.seccion" value="@Model.EntradaParcela.seccion">
                                            </div>
                                            <div class="col-lg-2 col-xs-2 col-sm-2 col-md-2">
                                                Sector
                                                <input class="centrado form-control" id="Sector" style="width:100%;" type="text" name="model.EntradaParcela.sector" value="@Model.EntradaParcela.sector">
                                            </div>
                                            <div class="col-lg-2 col-xs-2 col-sm-2 col-md-2 sin-padding">
                                                Tipo Div.
                                                <div class="container-fluid sin-padding">

                                                    <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12 sin-padding">
                                                    @Html.DropDownListFor(model => model.EntradaParcela.tipoDiv, (SelectList)ViewBag.tiposDivision,"", new { @class = "form-control sin-padding tipoDiv" })
                                                        @*<select class="form-control sin-padding tipoDiv" name="model.EntradaParcela.tipoDiv">
                                                            <option value="0">Manzana</option>
                                                            <option value="1">MACIZO</option>
                                                            <option value="2">FRACCION URBANA</option>
                                                            <option value="3">CHACRA</option>
                                                            <option value="4">QUINTA</option>
                                                            <option value="5">SECCION</option>
                                                            <option value="6">SOLAR</option>
                                                            <option value="7">FRACCION RURAL</option>
                                                            <option value="8">FRACCION REMANENTE DE UNA MAYO</option>
                                                            <option value="99">SIN IDENTIFICAR</option>
                                                        </select>*@
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-xs-2 col-sm-2 col-md-2">
                                                Nro TD
                                                <input class="centrado form-control" id="NroTD" style="width:100%;" type="text" name="model.EntradaParcela.valorTipo" value="@Model.EntradaParcela.valorTipo">
                                            </div>
                                            <div class="col-lg-2 col-xs-2 col-sm-2 col-md-2">
                                                Par/Lost
                                                <input class="centrado form-control" id="ParLost" style="width:100%;" type="text" name="model.EntradaParcela.parcela" value="@Model.EntradaParcela.parcela">
                                            </div>
                                        </div>

                                        <div class="row" style="height:5em;"></div>

                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 sin-padding">
                                                <input type="checkbox" aria-label="..." id="fechaParcelas" name="fechaParcelas" value="" class="fechaParcelas" checked>
                                            </div>
                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Fecha Desde: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="fechaDesdeParcelas" name="model.EntradaParcela.fechaDesde" class="fechaDesdeParcelas form-control" value="@Model.EntradaParcela.fechaDesdeParcela">
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Fecha Hasta: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="fechaHastaParcelas" name="model.EntradaParcela.fechaHasta" class="fechaHastaParcelas form-control" value="@Model.EntradaParcela.fechaHastaParcela">
                                                </div>
                                            </div>
                                        </div>

                                    }
                                    
                                    @using (Ajax.BeginForm("actualizarGrillaParcelas", "Interfaces", new { }, new AjaxOptions { }, new { id = "formGrillaParcela", role = "form", novalidate = "" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <div class="row" style="height:3em;">
                                        </div>
                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div class="col-lg-11 col-xs-11 col-sm-11 col-md-11">
                                                @Html.Label("Solo novedades")
                                                <img id="switch_parcelas" class="novedades" src="~/Content/images/Interfaces/icons/dark.blue/32/activo.png" style="cursor: pointer;">
                                                @Html.Label("Todo")
                                            </div>
                                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 pull-right ">
                                                <span id="buscarParcela" title="Buscar" class="glyphicon glyphicon-search" style="cursor:pointer; font-size:32px;"></span>
                                            </div>
                                        </div>
                                        <div class="row" style="height:3em;">
                                        </div>
                                        <div id="contedor-parcela" class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <table id="Grilla_parcelas" class="table table-striped table-bordered table-responsive grilla" cellspacing="0" style="width:100%;">
                                                <thead>
                                                    <tr>
                                                        <th class="no-sort"></th>
                                                        <th>Nom.Catastral</th>
                                                        <th>Existe</th>
                                                        <th>Graf.</th>
                                                        <th>Sup. Graf</th>
                                                        <th>UTsProv.</th>
                                                        <th>UTsMun.</th>
                                                        <th>Prov.</th>
                                                        <th>Mun.</th>
                                                        <th>Tipo</th>
                                                        <th>Clase</th>
                                                        <th>F.Alta</th>
                                                        <th>F.Baja</th>
                                                        <th>Actualización</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                   
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="contenedorInputsGrillaParcela">
                                        </div>
                                        <img title="Guardar" id="btnGrabarParcelas" class="pull-right" src="~/Content/images/Interfaces/icons/dark/32/checkbox.png" style="cursor: pointer; margin: 10px 10px 0px 0px;">
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @*<div id="accordionPartidas">
                    <div class="panel-group panel-primary">
                        <div class="panel-heading panel-activo" id="PanelPartida" style="height: 40px; padding-top: 10px;">
                            <div class="col-lg-11 col-xs-11 col-sm-11 col-md-11">
                                PARTIDAS
                            </div>
                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 text-right ">
                                <span id="Flecha_partidas" class="glyphicon glyphicon-chevron-down flecha-activada" style="cursor:pointer;"></span>
                            </div>
                        </div>
                        <div id="accordion_panel_2" class="panel-collapse collapse" aria-expanded="true" style="border: solid; border-width: 1px; border-color: #a5a5a5; color: #000000">
                            <div class="panel-body" style="padding: 5px 0 5px 0; ">
                                <div class="form-group">

                                    <div class="row" style="height:1em;"></div>

                                    @using (Ajax.BeginForm("actualizarGrillaPartidas", "Interfaces", new { }, new AjaxOptions { }, new { id = "formPartida", role = "form", novalidate = "" }))
                                    { @Html.AntiForgeryToken()
                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 sin-padding"></div>

                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Partida Desde: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="partidaDesde" name="model.EntradaPartida.partidaDesde" class="partidaDesde form-control" value="@Model.EntradaPartida.partidaDesde">
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Partida Hasta: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="partidaHasta" name="model.EntradaPartida.partidaHasta" class="partidaHasta form-control" value="@Model.EntradaPartida.partidaHasta">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" style="height:5em;"></div>

                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 sin-padding">
                                                <input type="checkbox" aria-label="..." id="fechaPartidas" name="fechaPartidas" value="" class="fechaPartidas" checked>
                                            </div>
                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Fecha Desde: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="fechaDesdePartidas" name="model.EntradaPartida.fechaDesde" class="fechaDesdePartidas form-control" value="@Model.EntradaPartida.fechaDesdePartida">
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding">
                                                <div class="col-lg-5 col-xs-5 col-sm-5 col-md-5 sin-padding texto-centrado">
                                                    @Html.Label("Fecha Hasta: ")
                                                </div>
                                                <div class="col-lg-7 col-xs-7 col-sm-7 col-md-7 sin-padding">
                                                    <input type="text" aria-label="..." style="text-align: center; width: 80%;" id="fechaHastaPartidas" name="model.EntradaPartida.fechaHasta" class="fechaHastaPartidas form-control" value="@Model.EntradaPartida.fechaHastaPartida">
                                                </div>
                                            </div>
                                        </div>
                                    }

                                    @using (Ajax.BeginForm("actualizarGrillaPartidas", "Interfaces", new { }, new AjaxOptions { }, new { id = "formGrillaPartida", role = "form", novalidate = "" }))
                                    { @Html.AntiForgeryToken()
                                        <div class="row" style="height:3em;"></div>

                                        <div class="col-lg-12 col-xs-12 col-sm-12 col-md-12">
                                            <div class="col-lg-11 col-xs-11 col-sm-11 col-md-11">
                                                @Html.Label("Solo novedades")
                                                <img id="switch_partidas" class="novedades" src="~/Content/images/Interfaces/icons/dark.blue/32/activo.png" style="cursor: pointer;">
                                                @Html.Label("Todo")
                                            </div>

                                            <div class="col-lg-1 col-xs-1 col-sm-1 col-md-1 pull-right ">
                                                <span id="buscarPartida" title="Buscar" class="glyphicon glyphicon-search" style="cursor:pointer; font-size:32px;"></span>

                                            </div>
                                        </div>

                                        <div class="row" style="height:3em;"></div>

                                        <div id="contedor-partidas" class="col-lg-12 col-xs-12 col-sm-12 col-md-12">

                                            

                                            <table id="Grilla_partidas" class="table table-striped table-bordered table-responsive grilla" cellspacing="0" style="width:100%;">
                                                <thead>
                                                    <tr>
                                                        <th class="no-sort"></th>
                                                        <th>Nom.Catastral</th>
                                                        <th>UF</th>
                                                        <th>Partida</th>
                                                        <th>F.Alta</th>
                                                        <th>F.Baja</th>
                                                        <th>Existe</th>
                                                        <th>Prov.</th>
                                                        <th>Mun.</th>

                                                    </tr>
                                                </thead>

                                                <tbody>
                                                  
                                                </tbody>
                                            </table>
                                        </div>

                                        <div id="contenedorInputsGrillaPartida">
                                        </div>
                                        <img title="Guardar" id="btnGrabarPartidas" class="pull-right" src="~/Content/images/Interfaces/icons/dark/32/checkbox.png" style="cursor: pointer; margin: 10px 10px 0px 0px;">

                                    }
                                </div>

                            </div>
                        </div>

                    </div>
                </div>*@
            </div>
        </div>
    </div>
</div>


<script src="~/Scripts/jquery.dataTables.js"></script>
<script src="~/Scripts/select2.js"></script>
<script src="~/Scripts/moment-with-locales.js" type="text/javascript"></script>
<script src="~/Scripts/bootstrap-datetimepicker.js" type="text/javascript"></script>
<script src="~/Scripts/jquery.form.js"></script>
<script>

    $(window).resize(ajustamodal);
    function ajustamodal() {
        var altura = $(window).height() - 190; //value corresponding to the modal heading + footer
        $(".modal-body-scroll").css({ "height": altura, "overflow-y": "auto" });
    }

    $(document).ready(function () {

        ajustamodal();

        $('#myModal').modal('show');

        $('#Grilla_parcelas').dataTable({
            "scrollY": "200px",
            "scrollX": true,
            "scrollCollapse": true,
            "paging": false,
            "searching": false,
            "bInfo": false,
            "destroy": true,
            "aaSorting": [[1, 'asc']],
            "language": {
                "url": BASE_URL + "Scripts/dataTables.spanish.txt"
            },
            "columnDefs": [
                {
                    "targets": 'no-sort',
                    "orderable": false,
                }
            ]
        });

        $('#Grilla_partidas').dataTable({
            "scrollY": "200px",
            "scrollX": true,
            "scrollCollapse": true,
            "paging": false,
            "searching": false,
            "bInfo": false,
            "destroy": true,
            "aaSorting": [[1, 'asc']],
            "language": {
                "url": BASE_URL + "Scripts/dataTables.spanish.txt"
            },
            "columnDefs": [
                {
                    "targets": 'no-sort',
                    "orderable": false,
                }
            ]
        });


        //$(".grilla tr").hover(function () {

        //    if ($(".reporteProvincial").hasClass("visibleProv")) {
        //        $(this).children().children().show();
        //        $(".reporteProvincial").removeClass("visibleProv");

        //    } else {

        //        $(".reporteProvincial").hide();
        //        $(".reporteMunicipal").hide();
        //        $(".reporteProvincial").addClass("visibleProv");
        //    }

        //});


        $('#fechaParcelas').click(function () {
            if ($('#fechaParcelas').is(":checked")) {

                $('#fechaDesdeParcelas').removeAttr("disabled");
                $('#fechaHastaParcelas').removeAttr("disabled");

            } else {

                $('#fechaDesdeParcelas').attr('disabled', 'disabled');
                $('#fechaDesdeParcelas').val("");
                $('#fechaHastaParcelas').attr('disabled', 'disabled');
                $('#fechaHastaParcelas').val("");
            }
        });

        $('#fechaDesdeParcelas').datetimepicker({
            viewMode: "days",
            format: "DD/MM/YYYY",
            locale: "es",
            //defaultDate: moment($(".id_feriado:checked").parent().find(".fecha").val(), 'DD/MM/YYYY hh:mm:ss a').format('DD/MM/YYYY')
        });

        $('#fechaHastaParcelas').datetimepicker({
            viewMode: "days",
            format: "DD/MM/YYYY",
            locale: "es",
            //defaultDate: moment($(".id_feriado:checked").parent().find(".fecha").val(), 'DD/MM/YYYY hh:mm:ss a').format('DD/MM/YYYY')
        });

        $("#fechaDesdeParcelas").on("dp.change", function (e) {
            $('#fechaHastaParcelas').data("DateTimePicker").minDate(e.date);
        });

        $("#fechaHastaParcelas").on("dp.change", function (e) {
            $('#fechaDesdeParcelas').data("DateTimePicker").maxDate(e.date);
        });

        $("#Flecha_parcelas").click(function () {

            if ($("#accordion_panel_1").hasClass("in") == false) {

                $("#accordion_panel_1").addClass("in");
                $("#Flecha_parcelas").removeClass("glyphicon-chevron-down");
                $("#Flecha_parcelas").addClass("glyphicon-chevron-up");

            } else {

                $("#accordion_panel_1").removeClass("in");
                $("#Flecha_parcelas").addClass("glyphicon-chevron-down");
                $("#Flecha_parcelas").removeClass("glyphicon-chevron-up");
            }
        });

        $("#switch_parcelas").click(function () {
            if ($("#switch_parcelas").hasClass("novedades")) {

                $("#switch_parcelas").attr('src', BASE_URL + 'Content/images/Interfaces/icons/dark.blue/32/no.activo.png');
                $("#switch_parcelas").removeClass("novedades");
                //src = "~/Content/images/Interfaces/icons/dark.blue/32/activo.png"
            } else {

                $("#switch_parcelas").attr('src', BASE_URL + 'Content/images/Interfaces/icons/dark.blue/32/activo.png');
                $("#switch_parcelas").addClass("novedades");

            }
        });

        $('#fechaPartidas').click(function () {
            if ($('#fechaPartidas').is(":checked")) {

                $('#fechaDesdePartidas').removeAttr("disabled");
                $('#fechaHastaPartidas').removeAttr("disabled");

            } else {

                $('#fechaDesdePartidas').attr('disabled', 'disabled');
                $('#fechaDesdePartidas').val("");
                $('#fechaHastaPartidas').attr('disabled', 'disabled');
                $('#fechaHastaPartidas').val("");
            }
        });

        $('#fechaDesdePartidas').datetimepicker({
            viewMode: "days",
            format: "DD/MM/YYYY",
            locale: "es",
            //defaultDate: moment($(".id_feriado:checked").parent().find(".fecha").val(), 'DD/MM/YYYY hh:mm:ss a').format('DD/MM/YYYY')
        });

        $('#fechaHastaPartidas').datetimepicker({
            viewMode: "days",
            format: "DD/MM/YYYY",
            locale: "es",
            //defaultDate: moment($(".id_feriado:checked").parent().find(".fecha").val(), 'DD/MM/YYYY hh:mm:ss a').format('DD/MM/YYYY')
        });

        $("#fechaDesdePartidas").on("dp.change", function (e) {
            $('#fechaHastaPartidas').data("DateTimePicker").minDate(e.date);
        });

        $("#fechaHastaPartidas").on("dp.change", function (e) {
            $('#fechaDesdePartidas').data("DateTimePicker").maxDate(e.date);
        });

        $("#Flecha_partidas").click(function () {

            if ($("#accordion_panel_2").hasClass("in") == false) {
                $("#accordion_panel_2").addClass("in");
                $("#Flecha_partidas").removeClass("glyphicon-chevron-down");
                $("#Flecha_partidas").addClass("glyphicon-chevron-up");

            } else {
                $("#accordion_panel_2").removeClass("in");
                $("#Flecha_partidas").addClass("glyphicon-chevron-down");
                $("#Flecha_partidas").removeClass("glyphicon-chevron-up");
            }

        });

        $("#switch_partidas").click(function () {
            if ($("#switch_partidas").hasClass("novedades")) {

                $("#switch_partidas").attr('src', BASE_URL + 'Content/images/Interfaces/icons/dark.blue/32/no.activo.png');
                $("#switch_partidas").removeClass("novedades");

            } else {

                $("#switch_partidas").attr('src', BASE_URL + 'Content/images/Interfaces/icons/dark.blue/32/activo.png');
                $("#switch_partidas").addClass("novedades");

            }
        });

        $("#btnCancelar").click(function () {
            $("#myModal").modal('hide');
        });

        $("#buscarParcela").click(function () {
            $.ajax({
                url: '@Url.Action("BuscarParcelas", "Interfaces")',
                data: {
                    circ: $("#Circ").val(),
                    seccion: $("#Sec").val(),
                    sector: $("#Sector").val(),
                    tipoDiv: $(".tipoDiv").val(),
                    valorTipo: $("#NroTD").val(),
                    parcela: $("#ParLost").val(),
                    fechaDesde: $("#fechaDesdeParcelas").val(),
                    fechaHasta: $("#fechaHastaParcelas").val()
                },
                dataType: 'json',
                success: function (data) {

                    $('#Grilla_parcelas').dataTable().fnDestroy();
                    $('#Grilla_parcelas tbody').html("");
                    var camposParcelas = "";
                    var comillaSimple = "'";
                    var fechaAlta = null;
                    var fechaAltaStr = "-";
                    var fechaBaja = null;
                    var fechaBajaStr = "-";
                    var idSelect = "";
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].FechaAlta != null) {
                            fechaAlta = new Date(parseInt(data[i].FechaAlta.replace("/Date(", "").replace(")/", ""), 10));
                            fechaAltaStr = fechaAlta.getDate() + '/' + (fechaAlta.getMonth() + 1) + '/' + fechaAlta.getFullYear();
                        }
                        if (data[i].FechaBaja != null) {
                            fechaBaja = new Date(parseInt(data[i].FechaBaja.replace("/Date(", "").replace(")/", ""), 10));
                            fechaBajaStr = fechaBaja.getDate() + '/' + (fechaBaja.getMonth() + 1) + '/' + fechaBaja.getFullYear();
                        }
                        var reportemuni = '<img title="Reporte Municipal" class="reporteMunicipal" id="reporteMunicipal" onclick=' + comillaSimple + 'window.open("' + BASE_URL + 'Interfaces/GetInformeParcelarioInterfaces?nomenc=' + data[i].NomenclaturaNCA + '", "_blank")' + comillaSimple + ' src="../Content/images/Interfaces/eye.png" style="cursor: pointer; display:none;">';
                        if (data[i].Letra != "SI") {
                            reportemuni = '';
                        }

                        idSelect = "selectParcela" + data[i].FeatId;
                        camposParcelas = camposParcelas + '<tr> ' +
                                                            '<td>' +
                                                                '<input type="checkbox" aria-label="..." name="Idparcela" value="' + data[i].FeatId + '" class="id_parcela">' +
                                                            '</td>' +
                                                            '<td>' + data[i].NomenclaturaNCA + '</td>' +
                                                            '<td>' + data[i].Letra + '</td>' +
                                                            '<td>' + data[i].NcaDepto + '</td>' +
                                                            '<td>' + data[i].SupGrafico + '</td>' +
                                                            '<td>' + data[i].Provincia + '</td>' +
                                                            '<td>' + data[i].NcaFraccion + '</td>' +
                                                            '<td> <img title="Reporte Provincial" class="visibleProv reporteProvincial" id="reporteProvincial" onclick=' + comillaSimple + 'window.open("'+BASE_URL+'Interfaces/GetInformeParcelarioInterfacesExterno?featid=' + data[i].FeatId + '" , "_blank")' + comillaSimple + ' src="../Content/images/Interfaces/eye.png" style="cursor: pointer; display:none;"></td>' +
                                                            '<td>' + reportemuni + '</td>' +
                                                            '<td>' + data[i].TipoDivision + '</td>' +
                                                            '<td>' + data[i].DescriClaseParcela + '</td>' +
                                                            '<td>' + fechaAltaStr + '</td>' +
                                                            '<td>' + fechaBajaStr + '</td>' +
                                                            '<td>' +
                                                                '<div class="container-fluid sin-padding">' +
                                                                     '<div class="col-lg-12 col-xs-12 col-sm-12 col-md-12 sin-padding">' +
                                                                          '<select id="' + idSelect + '" class="form-control sin-padding">' +
                                                                              '<option value="1">Ninguna</option>' +
                                                                            '<option value="2">Todo</option>' +
                                                                            '<option value="3">Solo Graf.</option>' +
                                                                            '<option value="4">Solo Alfa.</option>' +
                                                                        '</select>' +
                                                                    '</div>' +
                                                                  '</div> ' +
                                                           '</td>' +
                                                        ' </tr>';
                        fechaAltaStr = "-";
                        fechaBajaStr = "-";
                    }
                    $('#Grilla_parcelas tbody').html(camposParcelas);
                    $('#Grilla_parcelas').dataTable({
                        "scrollY": "200px",
                        "scrollX": true,
                        "scrollCollapse": true,
                        "paging": false,
                        "searching": false,
                        "bInfo": false,
                        //"destroy": true,
                        "aaSorting": [[1, 'asc']],
                        "language": {
                            "url": BASE_URL + "Scripts/dataTables.spanish.txt"
                        },
                        "columnDefs": [
                            {
                                "targets": 'no-sort',
                                "orderable": false,
                            }
                        ]
                    });
                    //$("#Grilla_parcelas tr").hover(function () {
                    //    if ($(".reporteProvincial").hasClass("visibleProv")) {
                    //        $(this).children().children().show();
                    //        $(".reporteProvincial").removeClass("visibleProv");
                    //    } else {
                    //        $(".reporteProvincial").hide();
                    //        $(".reporteMunicipal").hide();
                    //        $(".reporteProvincial").addClass("visibleProv");
                    //    }
                    //});
                },
                error: function (error) {
                    alert(error.responseText);
                }
            });
        });

        $("#buscarPartida").click(function () {
            $.ajax({
                url: '@Url.Action("BuscarPartidas", "Interfaces")',
                data: {
                    partidaDesde: $("#partidaDesde").val(),
                    partidaHasta: $("#partidaHasta").val(),
                    fechaDesde: $("#fechaDesdePartidas").val(),
                    fechaHasta: $("#fechaHastaPartidas").val()
                },
                dataType: 'json',
                success: function (data) {
                    $('#Grilla_partidas').dataTable().fnDestroy();
                    $('#Grilla_partidas tbody').html("");

                    var camposPartidas = "";
                    var comillaSimple = "'";
                    var fechaAlta = null;
                    var fechaAltaStr = "-";
                    var fechaBaja = null;
                    var fechaBajaStr = "-";
                    for (var i = 0; i < data.length; i++) {

                        if (data[i].FechaAlta != null) {
                            fechaAlta = new Date(parseInt(data[i].FechaAlta.replace("/Date(", "").replace(")/", ""), 10));
                            fechaAltaStr = fechaAlta.getDate() + '/' + (fechaAlta.getMonth() + 1) + '/' + fechaAlta.getFullYear();
                        }
                        if (data[i].FechaBaja != null) {
                            fechaBaja = new Date(parseInt(data[i].FechaBaja.replace("/Date(", "").replace(")/", ""), 10));
                            fechaBajaStr = fechaBaja.getDate() + '/' + (fechaBaja.getMonth() + 1) + '/' + fechaBaja.getFullYear();
                        }
                        var reportemuni = '<img title="Reporte Municipal" class="reporteMunicipal"  onclick=' + comillaSimple + 'window.open(' + BASE_URL + 'Interfaces/GetInformeUTInterfaces?padron=' + data[i].NroPartida + '", "_blank")' + comillaSimple + ' id="reporteMunicipal" src="../Content/images/Interfaces/eye.png" style="cursor: pointer; display:none;">';
                        if (data[i].Letra != "SI") {
                            reportemuni = '';
                        }

                        camposPartidas = camposPartidas + '<tr> <td> <input type="checkbox" aria-label="..." name="Idpartida" value="' + data[i].FeatId + '" class="id_partida"> </td>' +
                          '<td>' + data[i].NomenclaturaNCA + '</td>' +
                          '<td>' + data[i].UnidadFuncional + '</td>' +
                          '<td>' + data[i].NroPartida + '</td>' +
                          '<td>' + fechaAltaStr + '</td>' +
                          '<td>' + fechaBajaStr + '</td>' +
                          '<td>' + data[i].Letra + '</td>' +
                          '<td> <img title="Reporte Provincial" class="reporteProvincial visibleProv" id="reporteProvincial" onclick=' + comillaSimple + 'window.open("' + BASE_URL + 'Interfaces/GetInformeUTInterfacesExterno?FeatId=' + data[i].FeatId + '", "_blank")' + comillaSimple + 'src="../Content/images/Interfaces/eye.png" style="cursor: pointer; display:none;"></td>' +
                          '<td> ' + reportemuni + '</td>' +

                      ' </tr>';
                        fechaAltaStr = "-";
                        fechaBajaStr = "-";
                    }

                    $('#Grilla_partidas tbody').html(camposPartidas);

                    $('#Grilla_partidas').dataTable({
                        "scrollY": "200px",
                        "scrollX": true,
                        "scrollCollapse": true,
                        "paging": false,
                        "searching": false,
                        "bInfo": false,
                        //"destroy": true,
                        "aaSorting": [[1, 'asc']],
                        "language": {
                            "url": BASE_URL + "Scripts/dataTables.spanish.txt"
                        },
                        "columnDefs": [
                            {
                                "targets": 'no-sort',
                                "orderable": false,
                            }
                        ]
                    });

                    //$("#Grilla_partidas tr").hover(function () {

                    //    if ($(".reporteProvincial").hasClass("visibleProv")) {
                    //        $(this).children().children().show();
                    //        $(".reporteProvincial").removeClass("visibleProv");

                    //    } else {

                    //        $(".reporteProvincial").hide();
                    //        $(".reporteMunicipal").hide();
                    //        $(".reporteProvincial").addClass("visibleProv");
                    //    }

                    //});
                },
                error: function (error) {
                    alert(error.responseText);
                }
            });

            @*$("#formPartida").attr("Action", "@Url.Action("BuscarPartidas", "Interfaces")")
                $("#formPartida").submit();*@

        });

        $("#btnGrabarPartidas").click(function () {

            var lstPartida = $(".id_partida:checked");
            var inputsHidden = "";
            for (var i = 0; i < lstPartida.length; i++) {

                inputsHidden = inputsHidden + '<input type="hidden" name="ResultadoParcelas[' + i + '].FeatId" value="' + lstPartida[i].value + '"/>';
            }
            $("#contenedorInputsGrillaPartida").html(inputsHidden);
            $("#formGrillaPartida").submit();
        });

        $("#formGrillaPartida").ajaxForm({
            success: function (data) {
                //levantar modal
                $("#contenido").empty();
                $("#contenido").html(data);
                $("#accordion_panel_2").addClass('in');
            },
            error: function () {
                alert("error");
            }
        });

        $("#formGrillaPartida").submit(function (evt) {
            /*evita el doble submit*/
            evt.preventDefault();
            evt.stopImmediatePropagation();
            return false;
        });

        $("#btnGrabarParcelas").click(function () {
            var lstParcela = $(".id_parcela:checked");
            var idSelect = "";
            var inputsHidden = "";
            for (var i = 0; i < lstParcela.length; i++) {
                idSelect = "#selectParcela" + lstParcela[i].value;
                $(idSelect).val();
                inputsHidden = inputsHidden + '<input type="hidden" name="ResultadoParcelas[' + i + '].FeatIdParcela" value="' + lstParcela[i].value + '"/>' +
                                              '<input type="hidden" name="ResultadoParcelas[' + i + '].TipoActualizacion" value="' + $(idSelect).val() + '"/>';
            }
            $("#contenedorInputsGrillaParcela").html(inputsHidden);
            $("#formGrillaParcela").submit();
        });

        $("#formGrillaParcela").ajaxForm({
            success: function (data) {
                //levantar modal
                $("#contenido").empty();
                $("#contenido").html(data);
                $("#accordion_panel_1").addClass('in');
            },
            error: function () {
                alert("error");
            }
        });

        hideLoading();

        $("#formGrillaParcela").submit(function (evt) {
            /*evita el doble submit*/
            evt.preventDefault();
            evt.stopImmediatePropagation();
            return false;
        });

    });

</script>
